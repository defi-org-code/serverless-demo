service: serverless

custom:
  awsProject: "defi.org by Rotem"
  awsStorageARN: "arn:aws:elasticfilesystem:us-east-2:506367651493:access-point/fsap-02a6bda784f32d525"
  awsStorageSG: "sg-beb396d6"
  awsStorageSubnet: "subnet-25dd204d"

provider:
  name: aws
  runtime: nodejs14.x
  region: us-east-2
  tags:
    Project: ${self:custom.awsProject}
  stackTags:
    Project: ${self:custom.awsProject}
  deploymentBucket:
    tags:
      Project: ${self:custom.awsProject}
  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - ec2:CreateNetworkInterface
            - ec2:DescribeNetworkInterface
            - ec2:DeleteNetworkInterface
            - elasticfilesystem:ClientMount
            - elasticfilesystem:ClientRootAccess
            - elasticfilesystem:ClientWrite
            - elasticfilesystem:DescribeMountTargets
          Resource: ${self:custom.awsStorageARN}
      tags:
        Project: ${self:custom.awsProject}

functions:
  create:
    fileSystemConfig:
      localMountPath: /mnt/efs
      arn: ${self:custom.awsStorageARN}
      vpc:
        securityGroupIds:
          - ${self:custom.awsStorageSG}
        subnetIds:
          - ${self:custom.awsStorageSubnet}
    handler: handler.create
    events:
      - http:
          path: create/{value}
          method: get
          cors: true
  list:
    ${file(./serverless-fn.yml)}
    handler: handler.list
    events:
      - http:
          path: list
          method: get
          cors: true
  alive:
    ${file(./serverless-fn.yml)}
    handler: handler.alive
    events:
      - http:
          path: alive
          method: get
          cors: true
  exec:
    ${file(./serverless-fn.yml)}
    handler: handler.exec
    events:
      - http:
          path: exec/{value}
          method: get
          cors: true

#  list:
#    handler: handler.list
#    events:
#      - http:
#          path: list
#          method: get
#          cors: true
#  get:
#    handler: handler.get
#    events:
#      - http:
#          path: get/{id}
#          method: get
#          cors: true
#  update:
#    handler: handler.update
#    events:
#      - http:
#          path: update/{id}
#          method: get
#          cors: true
#  delete:
#    handler: handler.delete
#    events:
#      - http:
#          path: delete/{id}
#          method: get
#          cors: true
